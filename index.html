<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Chatbot — Single File</title>
  <style>
    :root { --bg:#0f1115; --panel:#171a23; --muted:#24283b; --text:#e8e8e8; --you:#3a3f58; --bot:#202437; --brand:#2a3cff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text); }
    .wrap { min-height:100vh; display:grid; place-items:center; padding:20px; }
    .card { width:min(920px, 96vw); background:var(--panel); border:1px solid var(--muted); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); overflow:hidden; }
    .header { padding:16px 20px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--muted); gap:10px; }
    .title { font-weight:700; letter-spacing:.2px; }
    .row { display:flex; gap:8px; align-items:center; }
    .btn { padding:10px 12px; border-radius:10px; border:1px solid #4a77ff33; background:var(--brand); color:#fff; cursor:pointer; }
    .btn.secondary { background:transparent; color:var(--text); border:1px solid var(--muted); }
    .chat { height:65vh; overflow-y:auto; padding:18px 20px; display:flex; flex-direction:column; gap:12px; }
    .line { display:flex; }
    .you { justify-content:flex-end; }
    .bot { justify-content:flex-start; }
    .bubble { max-width:78%; padding:12px 14px; border-radius:14px; line-height:1.45; white-space:pre-wrap; word-wrap:break-word; }
    .bubble.you { background:var(--you); }
    .bubble.bot { background:var(--bot); }
    form { display:flex; gap:10px; padding:16px; border-top:1px solid var(--muted); }
    input, select, button, textarea { font:inherit; }
    textarea { flex:1; resize:vertical; min-height:44px; max-height:160px; padding:12px 14px; border-radius:10px; border:1px solid #2b3050; background:#0f1324; color:#eee; }
    .controls { display:flex; gap:8px; align-items:center; }
    .helper { opacity:.8; font-size:12px; padding:0 20px 10px; }
    .footer { padding:10px 20px 18px; display:flex; gap:10px; align-items:center; justify-content:space-between; border-top:1px dashed var(--muted); }
    .select { background:#0f1324; color:#eee; border:1px solid #2b3050; border-radius:10px; padding:10px; }
    /* Simple modal */
    dialog { border:none; border-radius:14px; background:#151823; color:var(--text); width:min(520px, 92vw); }
    dialog::backdrop { background:rgba(0,0,0,.6); }
    .modal-body { padding:20px; display:grid; gap:12px; }
    .in { width:100%; padding:12px 14px; border-radius:10px; border:1px solid #2b3050; background:#0f1324; color:#eee; }
    .note { font-size:12px; opacity:.85; }
    code.k { user-select:all; background:#0f1324; padding:2px 6px; border-radius:6px; border:1px solid #2b3050; }
    a { color:#b8c3ff; }
  </style>
</head>
<body>
  <!--
    Single-file HTML chatbot for quick demos and local use.
    ⚠️ Security note: This page can call the OpenAI API directly from the browser.
       Only use it locally or on a private host. Never expose your secret key publicly.
  -->
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="title">AI Chatbot</div>
        <div class="row">
          <select id="model" class="select" title="Model">
            <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
            <option value="gpt-4o">gpt-4o</option>
            <option value="gpt-4o-mini-transcribe">gpt-4o-mini-transcribe</option>
          </select>
          <button class="btn secondary" id="setKey">API Key</button>
          <button class="btn secondary" id="clear">Clear</button>
        </div>
      </div>

      <div id="chat" class="chat"></div>
      <div class="helper">Type a message and press Enter. Your chat is kept in memory only (until you refresh).</div>

      <form id="form">
        <textarea id="input" placeholder="Ask me anything…"></textarea>
        <div class="controls">
          <button class="btn" id="send" type="submit">Send</button>
        </div>
      </form>

      <div class="footer">
        <div>Local demo — runs in your browser</div>
        <div style="font-size:12px; opacity:.75">Tip: press <code class="k">/key</code> to set key, <code class="k">/clear</code> to wipe chat.</div>
      </div>
    </div>
  </div>

  <dialog id="keyModal">
    <form method="dialog" class="modal-body">
      <h3>Enter your OpenAI API key</h3>
      <input id="apiKey" class="in" type="password" placeholder="sk-..." />
      <label style="display:flex; gap:8px; align-items:center">
        <input id="persist" type="checkbox" /> Remember in this browser (localStorage)
      </label>
      <div class="note">Only use this page locally or privately. If you publish it, anyone visiting can inspect the page and use your key. Safer option: put a tiny server in front of the API.</div>
      <menu style="display:flex; gap:10px; justify-content:flex-end; padding:0; margin:0">
        <button class="btn secondary" value="cancel">Cancel</button>
        <button class="btn" id="saveKey" value="default">Save</button>
      </menu>
    </form>
  </dialog>

  <script>
    // ===== State =====
    const chatEl = document.getElementById('chat');
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const setKeyBtn = document.getElementById('setKey');
    const clearBtn = document.getElementById('clear');
    const modelSel = document.getElementById('model');

    const keyModal = document.getElementById('keyModal');
    const apiKeyIn = document.getElementById('apiKey');
    const persist = document.getElementById('persist');

    const LS_KEY = 'demo_openai_key';
    let API_KEY = localStorage.getItem(LS_KEY) || '';

    const messages = [
      { role: 'system', content: 'You are a helpful, concise assistant.' }
    ];

    // ===== UI helpers =====
    function addBubble(text, who) {
      const row = document.createElement('div');
      row.className = `line ${who}`;
      const b = document.createElement('div');
      b.className = `bubble ${who}`;
      b.textContent = text;
      row.appendChild(b);
      chatEl.appendChild(row);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function setBusy(b) { sendBtn.disabled = b; input.disabled = b; }

    function ensureKey() {
      if (!API_KEY) {
        apiKeyIn.value = '';
        persist.checked = false;
        keyModal.showModal();
        return false;
      }
      return true;
    }

    // ===== Key modal =====
    setKeyBtn.addEventListener('click', () => {
      apiKeyIn.value = API_KEY;
      persist.checked = !!localStorage.getItem(LS_KEY);
      keyModal.showModal();
    });

    document.getElementById('saveKey').addEventListener('click', (e) => {
      e.preventDefault();
      API_KEY = apiKeyIn.value.trim();
      if (persist.checked) {
        localStorage.setItem(LS_KEY, API_KEY);
      } else {
        localStorage.removeItem(LS_KEY);
      }
      keyModal.close();
    });

    // ===== Commands =====
    function handleSlashCommands(text) {
      const t = text.trim();
      if (t === '/key') { setKeyBtn.click(); return true; }
      if (t === '/clear') { chatEl.innerHTML=''; messages.splice(1); addBubble("Chat cleared.", 'bot'); return true; }
      return false;
    }

    // ===== Chat flow =====
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      if (handleSlashCommands(text)) { input.value=''; return; }
      if (!ensureKey()) return;

      input.value = '';
      addBubble(text, 'you');
      setBusy(true);

      messages.push({ role: 'user', content: text });

      try {
        const model = modelSel.value;
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model,
            messages: messages.slice(-20),
            temperature: 0.7
          })
        });

        if (!res.ok) {
          const errText = await res.text();
          throw new Error(errText || res.statusText);
        }

        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content || '(no reply)';
        messages.push({ role: 'assistant', content: reply });
        addBubble(reply, 'bot');
      } catch (err) {
        addBubble('Error: ' + (err.message || 'request failed'), 'bot');
      } finally {
        setBusy(false);
      }
    });

    // Greet
    addBubble("Hi! I'm your AI chatbot. Type /key to set your API key.", 'bot');
  </script>
</body>
</html>
