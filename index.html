<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini AI — Math / Essay / Q&A</title>
  <style>
    body{font-family:Inter,system-ui,Arial;margin:0;background:#f6f8fa;color:#111}
    .container{max-width:900px;margin:32px auto;padding:24px;background:white;border-radius:12px;box-shadow:0 6px 30px rgba(10,20,40,0.06)}
    h1{margin:0 0 12px;font-size:22px}
    textarea{width:100%;min-height:110px;padding:10px;font-size:15px;border-radius:8px;border:1px solid #dbe3ea;resize:vertical}
    select,input,button{padding:10px;border-radius:8px;border:1px solid #dbe3ea;font-size:15px}
    .row{display:flex;gap:10px;margin:10px 0}
    .col{flex:1}
    #response{white-space:pre-wrap;background:#f7fafc;padding:12px;border-radius:8px;border:1px dashed #e2e8f0;min-height:120px}
    label{font-weight:600;font-size:13px}
    .muted{color:#5b6b74;font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <h1>Mini AI — Math · Essay · Q&amp;A</h1>
    <p class="muted">Choose a mode, type a prompt, and click <strong>Ask AI</strong>. This app sends your prompt to a secure server which calls OpenAI.</p>

    <div class="row">
      <div class="col">
        <label for="mode">Mode</label><br/>
        <select id="mode">
          <option value="qa">Q&amp;A</option>
          <option value="essay">Essay</option>
          <option value="math">Math (show steps)</option>
        </select>
      </div>
      <div class="col" style="flex:0.6">
        <label for="model">Model</label><br/>
        <select id="model">
          <option value="gpt-4o-mini">gpt-4o-mini</option>
          <option value="gpt-4o">gpt-4o</option>
          <option value="gpt-4">gpt-4</option>
          <option value="gpt-3.5-turbo" selected>gpt-3.5-turbo</option>
        </select>
      </div>
    </div>

    <div style="margin-top:10px">
      <label for="prompt">Prompt</label>
      <textarea id="prompt" placeholder="Type the question, problem, or essay topic here..."></textarea>
    </div>

    <div class="row" style="margin-top:12px;align-items:center">
      <div style="flex:0.6">
        <button id="askBtn">Ask AI</button>
      </div>
      <div style="flex:1;text-align:right" class="muted">
        <span id="status">Idle</span>
      </div>
    </div>

    <h3 style="margin-top:18px">Answer</h3>
    <div id="response">No answer yet.</div>
  </div>

  <script>
    const askBtn = document.getElementById('askBtn');
    const promptEl = document.getElementById('prompt');
    const responseEl = document.getElementById('response');
    const modeEl = document.getElementById('mode');
    const modelEl = document.getElementById('model');
    const statusEl = document.getElementById('status');

    // Helper: build system messages based on mode
    function buildSystemAndUser(mode, userPrompt) {
      let system = "You are a helpful assistant. Be concise and professional.";
      let user = userPrompt;

      if (mode === 'math') {
        system = "You are a highly accurate mathematician. Show step-by-step reasoning for calculations, and give the final numeric answer clearly. If the problem is purely arithmetic, prefer exact results. If the user requests approximate, say so.";
        user = "Solve this math problem and show step-by-step work:\n\n" + userPrompt;
      } else if (mode === 'essay') {
        system = "You are a clear, well-structured essay writer. Produce an essay with an intro, 2–4 body paragraphs, and a conclusion. Use an appropriate formal tone and include a short thesis.";
        user = "Write an essay on the following topic:\n\n" + userPrompt;
      } else { // qa
        system = "You are a helpful Q&A assistant. Answer directly and clearly. If unsure, say you don't know and suggest how to find out.";
        user = userPrompt;
      }
      return {system, user};
    }

    askBtn.addEventListener('click', async () => {
      const prompt = promptEl.value.trim();
      if (!prompt) {
        alert('Type a prompt first.');
        return;
      }

      responseEl.textContent = 'Thinking...';
      statusEl.textContent = 'Sending request…';

      const mode = modeEl.value;
      const model = modelEl.value;
      const {system, user} = buildSystemAndUser(mode, prompt);

      try {
        const res = await fetch("https://ai-chat-6v6e.onrender.com/api/chat", {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            model,
            messages: [
              {role: 'system', content: system},
              {role: 'user', content: user}
            ],
            // optional: limit tokens server-side if you want
          })
        });

        if (!res.ok) {
          const txt = await res.text();
          throw new Error('Server error: ' + res.status + ' — ' + txt);
        }

        const data = await res.json();
        // expected data: { id, choices: [ { message: { content } } ], ... }
        const content = data?.choices?.[0]?.message?.content ?? JSON.stringify(data, null, 2);
        responseEl.textContent = content;
        statusEl.textContent = 'Done';
      } catch (err) {
        responseEl.textContent = 'Error: ' + err.message;
        statusEl.textContent = 'Error';
      }
    });
  </script>
</body>
</html>
